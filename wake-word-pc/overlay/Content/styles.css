html, body {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
  background: transparent;
  overflow: hidden;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}

#root {
  position: fixed;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  --accent: #00ffaa;
  --col-gap: clamp(14px, 2vw, 28px);
  --dim: rgba(0, 0, 0, 0.26);
  --inactive: rgba(255, 255, 255, 0.06);
  --seg-gap: 4px;
  --glow1: 10px;
  --glow2: 18px;
  --sub-offset: 0px;
  color: white;
}

#backdrop {
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  background: var(--dim);
  opacity: 0;
  transition: opacity 220ms ease;
  pointer-events: none;
}

#root.active #backdrop {
  opacity: 1;
}


/* Center stack (3:2 screens look best with slightly higher center) */
#center {
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  transition: opacity 160ms ease;
  transform: translateY(-2.5vh) scale(var(--center-scale, 1));
  transform-origin: 50% 50%;
}

#root.idle #center {
  opacity: 0;
}

/* When connected, keep the center visible but do NOT dim the background. */
#root.connected #center {
  opacity: 1;
}

#root.connected #backdrop {
  opacity: 0;
}

/* In the CEF host we are often both .connected and .active.
   Ensure "active" can still dim the dashboard. */
#root.connected.active #backdrop {
  opacity: 1;
}

#root.active #center {
  opacity: 1;
}

/* KITT voicebox: 7 columns of discrete segments */
#kitt {
  width: 1400px;
  width: min(1400px, 92vw);
  height: 520px;
  height: min(520px, 40vh);
  display: flex;
  justify-content: center;
  /* NOTE: Chromium 75 (CEF 75) does not support flexbox gap.
     Use margins on children so user-settings colGap works in the desktop host. */
  align-items: flex-end;
}

.col {
  width: 45px;
  width: clamp(28px, 3.3vw, 56px);
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  /* NOTE: Chromium 75 (CEF 75) does not support flexbox gap. */
  align-items: stretch;
  margin-left: calc(var(--col-gap) * 0.5);
  margin-right: calc(var(--col-gap) * 0.5);
}

.seg {
  margin-bottom: var(--seg-gap);
}

.seg:last-child {
  margin-bottom: 0;
}

.seg {
  width: 100%;
  height: 12px;
  border-radius: 3px;
  /* IMPORTANT: off segments must be truly invisible in a transparent overlay host.
     A faint background looks fine on white, but shows as "ghost blocks" over desktop capture. */
  background: transparent;
  box-shadow: none;
  /* Keep the element visible so ::before can render; off-state is controlled via --p. */
  opacity: 1;
  /* Per-segment intensity is driven by --p (0..1). */
  --p: 0;
}

.seg.on {
  --p: 1;
}

.seg::before {
  content: '';
  display: block;
  width: 100%;
  height: 100%;
  border-radius: inherit;
  opacity: var(--p);

  /* KITT-ish fill: bright core + subtle vertical highlight.
     Using var(--accent) keeps persona color working. */
  background:
    linear-gradient(180deg, rgba(255,255,255,0.22), rgba(255,255,255,0) 46%, rgba(0,0,0,0.16)),
    /* IMPORTANT: this is a single wide gradient sampled across all 7 columns. */
    linear-gradient(90deg, transparent 0%, var(--accent) 46%, var(--accent) 54%, transparent 100%);

  /* Make the horizontal gradient span across the full bar, not repeat per segment. */
  background-size: 100% 100%, 700% 100%;
  background-position: 0 0, var(--col-pos, 50%) 0;

  box-shadow:
    0 0 var(--glow1) var(--accent),
    0 0 var(--glow2) var(--accent);
}

.subtitle {
  width: 1080px;
  width: min(1080px, 92vw);
  margin-top: 22px;
  padding: 0;
  background: transparent;
  border: 0;
  box-shadow: none;
  text-align: center;
  font-size: 34px;
  font-size: clamp(24px, 2.6vw, 42px);
  line-height: 1.18;
  /* Prevent 2-line wraps from shifting the KITT bar position.
     The font size is controlled via JS, so use em-based height. */
  min-height: calc(2 * 1.18em);
  letter-spacing: 0.2px;
  color: var(--accent);
  position: relative;
  z-index: 2;
  /* Heavy layered shadows so it reads over dashboards */
  text-shadow:
    0 1px 0 rgba(0,0,0,0.70),
    0 2px 0 rgba(0,0,0,0.68),
    0 3px 0 rgba(0,0,0,0.66),
    0 6px 12px rgba(0,0,0,0.62),
    0 12px 26px rgba(0,0,0,0.55),
    0 22px 48px rgba(0,0,0,0.42);

  opacity: 0;
  transform: translateY(calc(var(--sub-offset) + 8px));
  /* Avoid CSS filter transitions: some CEF/OSR hosts intermittently fail to render filtered text. */
  filter: none;
  transition:
    opacity 240ms cubic-bezier(0.2, 0.85, 0.2, 1),
    transform 240ms cubic-bezier(0.2, 0.85, 0.2, 1);
}

.subtitle.show {
  opacity: 1;
  transform: translateY(var(--sub-offset));
}

.subtitle.hide {
  opacity: 0;
  transform: translateY(calc(var(--sub-offset) + 6px));
  transition:
    opacity 220ms cubic-bezier(0.8, 0.05, 0.2, 1),
    transform 220ms cubic-bezier(0.8, 0.05, 0.2, 1);
}

.audio-unlock {
  display: none;
}

.audio-err {
  display: none;
}
